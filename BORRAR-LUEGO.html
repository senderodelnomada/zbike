// ESTE ES EL SCRIPT //

var qrcode = new QRCode("qrcode");
var url = document.location.href;
console.log(url);
var k = url.lastIndexOf("k=")>0 ? url.substr(url.lastIndexOf("k=")+2) : "";

if(k){
  console.log(k);
  $(".lds-ring").show();
  fetch(AS_URL_BASE+'?k='+k)
  .then(r => r.text())
  .then((r) => {
    console.log(r);
    //document.write(r);
    if(r){
      document.location.replace(r);
    }
  })
  .catch(err => console.log(err))

}
else
{
  // si no hay clave, mostrar generador de QR
  $("#urlWS").text(AS_URL_BASE);
  $("#qrEdit").show();

  function makeCode() {
    var calId = $("#calId").val();
    if(calId){
      var qrTargetUrl=url+"?k="+encodeURI(calId);
      $("#urlQR").text(qrTargetUrl);
      $("#urlQR").attr("href",qrTargetUrl);
      qrcode.makeCode(qrTargetUrl);
    }
  }

  makeCode();

  $("#calId").
    on("blur", function () {
      makeCode();
    }).
    on("keydown", function (e) {
      if (e.keyCode == 13) {
        makeCode();
      }
    });
}


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <script src="config.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.js"></script>
    
  <div class="lds-ring" style="display: none"><div></div><div></div><div></div><div></div></div>
  
  <div id="qrEdit" style="display: none; text-align: left">
    URL webservice: <span id="urlWS"></span><br />
    Introduce ID de Google Calendar: <input id="calId" type="text" style="width:80%" value="o62pu0pik35q3jgjvsecoobgt4@group.calendar.google.com"/><br />
    QR: <a id="urlQR"></a><br />
    <div id="qrcode"></div>
  </div>
  
  <script src="script.js"></script>
  
</body>
</html>


<!---->


<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&bull;&nbsp; ZBIKE &nbsp;&bull;</title>
    <style>
      body {
        background-color: lightblue;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <script>
      <!-- Programa lo que quieras -->
    </script>
    <p>Esta página web es una página HTML válida.</p>
  </body>
</html>
